---
title: "Database Schema"
description: "Exploring our database models and their relationships"
---

# Database Schema

## Overview

Our application uses SQLite with Drizzle ORM for type-safe database operations. The schema is organized by feature modules, with each module containing its own models.

## Authentication Models

### User Model

```typescript
// auth/models/z.user.ts
import { sqliteTable, text, integer } from "drizzle-orm/sqlite-core";

export const users = sqliteTable("users", {
  id: text("id", { length: 36 }).notNull(),
  email: text("email").notNull().unique(),
  password: text("password"),
  name: text("name"),
  createdAt: integer("created_at").notNull().default(0),
  updatedAt: integer("updated_at").notNull().default(0),
}, (table) => ({
  pk: primaryKey(table.id),
}));
```

The user model handles core user data and authentication:
- UUID-based primary key
- Email/password authentication
- Basic profile information
- Timestamp tracking

### Session Model

```typescript
// auth/models/z.session.ts
import { sqliteTable, text, integer } from "drizzle-orm/sqlite-core";

export const sessions = sqliteTable("sessions", {
  id: text("id", { length: 36 }).notNull(),
  userId: text("user_id")
    .notNull()
    .references(() => users.id, { onDelete: "cascade" }),
  activeToken: text("active_token").notNull(),
  expiresAt: integer("expires_at").notNull(),
  createdAt: integer("created_at").notNull().default(0),
  updatedAt: integer("updated_at").notNull().default(0),
}, (table) => ({
  pk: primaryKey(table.id),
}));
```

Handles JWT-based session management:
- Links sessions to users
- Stores active JWT tokens
- Manages session expiration
- Cascading deletion with users

### OAuth Model

```typescript
// auth/models/z.oauth.ts
export const OAuthProvider = {
  GITHUB: "GITHUB",
  GOOGLE: "GOOGLE",
} as const;

export const oauthAccounts = sqliteTable("oauth_accounts", {
  id: text("id", { length: 36 }).notNull(),
  userId: text("user_id")
    .notNull()
    .references(() => users.id, { onDelete: "cascade" }),
  provider: text("provider", { enum: ["GITHUB", "GOOGLE"] }).notNull(),
  providerAccountId: text("provider_account_id").notNull(),
  providerUsername: text("provider_username"),
  createdAt: integer("created_at").notNull().default(0),
  updatedAt: integer("updated_at").notNull().default(0),
}, (table) => ({
  pk: primaryKey(table.id),
  unq1: unique().on(table.provider, table.providerAccountId),
  unq2: unique().on(table.userId, table.provider),
}));
```

Manages OAuth provider connections:
- Supports GitHub and Google
- Links provider accounts to users
- Ensures unique provider connections
- Stores provider-specific information

## Profile Model

```typescript
// profile/models/z.profile.ts
export const profiles = sqliteTable("profiles", {
  id: text("id", { length: 36 }).notNull(),
  userId: text("user_id")
    .notNull()
    .references(() => users.id, { onDelete: "cascade" }),
  bio: text("bio"),
  avatarUrl: text("avatar_url"),
  location: text("location"),
  website: text("website"),
  theme: text("theme").default("light"),
  language: text("language").default("en"),
  currency: text("currency").default("EUR"),
  createdAt: integer("created_at").notNull().default(0),
  updatedAt: integer("updated_at").notNull().default(0),
}, (table) => ({
  pk: primaryKey(table.id),
}));
```

Stores extended user profile information:
- One-to-one relationship with users
- User preferences (theme, language, currency)
- Profile details (bio, avatar, location)
- Default values for preferences

## Schema Design Principles

1. **Modularity**
   - Each feature has its own models directory
   - Models are prefixed with `z.` for clarity
   - Clear separation of concerns

2. **Timestamps**
   - All tables include `createdAt` and `updatedAt`
   - Unix timestamp format (seconds since epoch)
   - Default value of 0 for new records

3. **Relationships**
   - Foreign keys with cascade deletion
   - Proper indexing for performance
   - Unique constraints where needed

4. **Type Safety**
   - Full TypeScript support via Drizzle
   - Enum validation for specific fields
   - Required fields marked as `notNull()`

## Usage

### Database Operations
```typescript
import { db } from "@server/db/client";
import { users } from "@modules/auth/models/z.user";

// Example query
const user = await db.query.users.findFirst({
  where: eq(users.email, email)
});
```

### Environment Setup
```bash
# Database URL in .env
DATABASE_URL="file:local.db"
```

### Available Commands
```bash
# Generate migrations
pnpm db:generate

# Push schema changes
pnpm db:push

# Open Drizzle Studio
pnpm db:studio
```

## Schema Exports

All schemas are re-exported through a central file:

```typescript
// server/db/schemas/index.ts
export * from '@modules/auth/models/z.user';
export * from '@modules/auth/models/z.session';
export * from '@modules/auth/models/z.oauth';
export * from '@modules/profile/models/z.profile';
```

## Related Topics

<Cards>
  <Card 
    title="Database Setup" 
    href="/docs/database/setup"
    description="Learn how to set up the database layer" 
  />
  <Card 
    title="Database Architecture" 
    href="/docs/database/architecture"
    description="Understand our database architecture" 
  />
  <Card 
    title="Database Operations" 
    href="/docs/database/operations"
    description="Learn how to perform database operations" 
  />
</Cards> 